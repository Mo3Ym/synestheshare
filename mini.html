<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>画像生成＆紙吹雪モーダル</title>
<style>
  body { font-family: sans-serif; margin: 0; padding: 0; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; background:#f0f0f0; }
  #generateBtn { padding:10px 20px; font-size:16px; cursor:pointer; margin-bottom:20px; }
  #previewImage { max-width:300px; max-height:300px; border:1px solid #ccc; margin-bottom:20px; }

  /* モーダルスタイル */
  .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:1000; }
  .modal-content { position:relative; background:white; padding:20px; border-radius:10px; text-align:center; max-width:90%; max-height:90%; }
  .modal-content img { max-width:100%; max-height:60vh; border-radius:5px; }
  .close { position:absolute; top:10px; right:15px; font-size:24px; cursor:pointer; }
  .hint { font-size:14px; margin-top:10px; color:#555; }

  /* モーダル専用キャンバス */
  #modalConfetti { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:999; }
</style>
</head>
<body>

<button id="generateBtn">画像生成</button>
<img id="previewImage" alt="生成画像">

<!-- 完成モーダル -->
<div id="completeModal" class="modal">
  <div class="modal-content">
    <span class="close" id="completeClose">&times;</span>
    <h1>🎉完成！🎉</h1>
    <img id="modalPreview" alt="生成画像">
    <p class="hint">画像を <b>長押し</b> または <b>右クリック</b> で保存</p>
  </div>
  <!-- モーダル専用キャンバス -->
  <canvas id="modalConfetti"></canvas>
</div>

<!-- confetti CDN -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
  const generateBtn = document.getElementById('generateBtn');
  const previewImage = document.getElementById('previewImage');
  const completeModal = document.getElementById('completeModal');
  const completeClose = document.getElementById('completeClose');
  const modalPreview = document.getElementById('modalPreview');
  const modalCanvas = document.getElementById('modalConfetti');

  // 紙吹雪用オブジェクト
  const myConfetti = confetti.create(modalCanvas, { resize: true });

  generateBtn.addEventListener('click', () => {
    // デモ用にランダム画像を表示
    const randomId = Math.floor(Math.random() * 1000);
    const imageUrl = `https://picsum.photos/400/400?random=${randomId}`;
    previewImage.src = imageUrl;

    // モーダル表示
    modalPreview.src = imageUrl;
    completeModal.style.display = 'flex';

    // 紙吹雪発動
    myConfetti({
      particleCount: 150,
      spread: 100,
      origin: { y: 0.5 }
    });
  });

  completeClose.addEventListener('click', () => {
    completeModal.style.display = 'none';
  });

  // モーダル外クリックで閉じる
  completeModal.addEventListener('click', (e) => {
    if (e.target === completeModal) {
      completeModal.style.display = 'none';
    }
  });
</script>

</body>
</html>
