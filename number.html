<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SynestheShare 「数字ってどんな色？」</title>
<link rel="icon" href="./assets/icons/favicon.ico">
<!-- Google Fonts 経由で Noto Sans JP を読み込み -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@600;800&display=swap" rel="stylesheet">
<!-- Google Fonts Outfit を読み込み -->
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">
<!-- Google Fonts Outfit ExtraLight 200を読み込み -->
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="assets/css/main_sub.css" />
<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>

<style>
@font-face {
  font-family: 'font';
  src: url('font/03スマートフォントUI.otf') format('opentype');
}
@font-face {
  font-family: 'ar-gothic';
  src: url('AR-ADGothicJP-Medium.otf') format('opentype');
}

:root{--bg:#FFFFFF;--ui:#111}

html, body {
  height:100%;
  margin:0;
  padding:0;
  font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Helvetica,Arial,sans-serif;
  background:var(--bg);
  color:var(--ui);
}

/* ロゴ帯 */
.logo {
  background-color: #f0f0f0;
  width: 100%;
  padding: 20px 0;
  display: flex;
  justify-content: center;
  align-items: center;
}
.logo a {
  display: inline-block;
  margin: 0;
  padding: 0;
}
.logo img {
  display: block;
  margin: 0 auto;
  max-width: 70%;  /* 基本: 幅70%以内 */
  height: auto;
}

/* デバイスごとのロゴサイズ */
@media (min-width:1024px) {  /* PC */
  .logo img { max-width: 25%; }
}
@media (min-width:600px) and (max-width:1023px) {  /* タブレット */
  .logo img { max-width: 50%; }
}
@media (max-width:599px) {  /* スマホ */
  .logo img { max-width: 70%; }
}

/* 以下は元のCSS（必要部分のみ抜粋） */
.wrap{
  max-width:800px;
  margin:0 auto;
  padding:14px;
  display:flex;
  flex-direction:column;
  align-items:center;
}
h1{font-size:18px;margin:0 0 8px;font-weight:800;text-align:center}

/* controls グリッド（レスポンシブ：画面幅に応じて1〜5列、最大5列） */
.controls-grid{
  display:grid;
  gap:12px;
  margin-bottom:10px;
  width:100%;
  grid-template-columns: repeat(1, 1fr);
  align-items: start;
}

.kana-card{
  border:1px solid #eee;
  padding:6px 8px;
  border-radius:6px;
  background:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  box-sizing:border-box;
  width:100%;
  min-height:44px;
}
.kana-row{display:flex;align-items:center;gap:8px;flex-wrap:nowrap}
.kana-row label{
  width:auto;
  font-weight:700;
  text-align:center;
  display:inline-block;
  line-height:1;
}
.color-input{
  width:40px;
  height:40px;
  border:0;
  padding:0;
  background:none;
  -webkit-appearance:none;
  appearance:none;
  border-radius:50%;
  aspect-ratio:1/1;
}
.color-input::-webkit-color-swatch{
  border:none;
  border-radius:50%;
  padding:0;
}
.color-input::-webkit-color-swatch-wrapper{
  border-radius:50%;
  padding:0;
}
.color-input::-moz-color-swatch{
  border:none;
  border-radius:50%;
}
.small-btn{padding:6px 8px;border-radius:6px;border:1px solid #ddd;background:#fafafa;font-size:13px;cursor:pointer}
.preview{display:flex;justify-content:center;margin:12px 0;width:100%}
canvas{display:none;}
#previewImage{
  max-width:100%;
  height:auto;
  border-radius:8px;
  box-shadow:0 8px 20px rgba(0,0,0,0.06);
  background:#fff;
  display:block;
  border:1px solid #ccc;
}
.actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-bottom:12px;width:100%}
button.main{padding:10px 12px;border-radius:8px;border:0;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:6px;background-color:#ffffff;}
button.black{padding:10px 12px;border-radius:8px;border:0;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:6px;background-color:#000000;color:#ffffff;}
.download{background:#1da1f2;color:#fff}
.share{background:#111;color:#fff}
.hint{font-size:14px;color:#666;margin-top:6px;text-align:center}
footer{display:flex;justify-content:center;padding-top:10px;font-size:14px;color:#111;width:100%}
.ex{font-size:12px;color:#666;margin-top:6px;text-align:center}
.footer-separator{
  width:100%;
  border-top:1px solid #ddd;
  margin:20px 0 10px 0;
}

/* レスポンシブ列数 */
@media (min-width:360px){
  .controls-grid{ grid-template-columns: repeat(2, 1fr); }
}
@media (min-width:720px){
  .controls-grid{ grid-template-columns: repeat(3, 1fr); }
}
@media (min-width:980px){
  .controls-grid{ grid-template-columns: repeat(4, 1fr); }
}
@media (min-width:1200px){
  .controls-grid{ grid-template-columns: repeat(5, 1fr); }
}

/* モーダル */
.modal {
  display:none; 
  position:fixed;
  z-index:1000;
  left:0;top:0;
  width:100%;height:100%;
  overflow:auto;
  background:rgba(0,0,0,0.6);
}
.modal-content {
  background:#fff;
  margin:10% auto;
  padding:20px;
  border-radius:10px;
  max-width:400px;
  text-align:center;
}
.modal-content p {
  text-align: left;
}
.modal-content img{
  max-width:100%;
  height:auto;
  margin-top:10px;
}
.close {
  color:#aaa;
  float:right;
  font-size:24px;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>

<body>
<!-- ロゴ -->
<div class="logo">
  <a href="index.html" target="_blank">
    <img src="images_sub/logo.png" alt="SynestheShare ロゴ">
  </a>
</div>

<div class="wrap">
    <!-- Step1画像 -->
    <div class="step1"><h1_1><img src="images_sub/step1_icon.png" style="height:35px;"><font size=4><b>色を選択</b></font></h1_1></div>
    <br>

    <!-- カラーピッカー -->
    <div class="controls-grid" id="controlsGrid"></div>

    <!-- 一時保存 / 初期化ボタン -->
    <div class="actions">
      <button id="saveBtn" class="button big wide smooth-scroll-middle"><img src="images_sub/save.png" alt="" style="width:18px;height:18px;"><span>入力内容を一時保存</span></button>
      <button id="resetBtn" class="button big wide smooth-scroll-middle"><img src="images_sub/reset.png" alt="" style="width:18px;height:18px;">色を初期化</button>
    </div>

    <br><br><br><br><br>

    <!-- Step2画像 -->
    <div class="step2"><h1_2><img src="images_sub/step2_icon.png" style="height:30px;"><font size=4><b>プレビュー</b></font></h1_2></div>

    <!-- プレビュー画像 -->
    <div class="preview">
      <canvas id="preview" width="1300" height="1300"></canvas>
      <img id="previewImage" alt="生成画像" />
    </div>
    <p class="hint">※画像を <b>長押し</b> または <b>右クリック</b> で保存</p>

    <!-- ポストボタン -->
    <div class="actions">
      <button  class="button big wide smooth-scroll-middle" id="shareBtn"><img src="images_sub/post.png" alt="x" style="width:16px;height:16px;">でポスト</button>
    </div>
    <br><br><br>

    <!-- フッター -->
    <div class="footer-separator"></div>
    <p class="ex">&copy; Untitled. Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
    <p class="ex">フォント：スマートフォントUI<br>フリーダウンロード：https://flopdesign.booth.pm/items/2296502</p>
</div>

<!-- モーダル -->
<div id="saveModal" class="modal">
  <div class="modal-content">
    <span class="close" id="saveClose">&times;</span>
    <p>サイトURLをコピーしてメモアプリ等に保存してください。<br>※選択した色情報はURLの<font color="#FF6969">末尾</font>に含まれています。</p>
    <img src="images_sub/howtosave.png" alt="保存方法">
  </div>
</div>

<script>
/*
  変更点
  - 薄い色を選んだとき、縁取りはその色を「明度だけ下げた濃い色」にする
*/

// 設定
const FONT_SIZE_RATIO = 0.8;
const BRIGHTNESS_THRESHOLD = 0.8;
const TEXT_STROKE_WIDTH = 1;
const CIRCLE_STROKE_WIDTH = 0.5;
const BORDER_LINE_WIDTH = 4;
const CIRCLE_RADIUS = 100;
const CIRCLE_GAP = 232;
const CIRCLE_HORIZONTAL_GAP = 232;
const CENTER_VERTICAL_GAP = 602;

const defaultColors = ["#000000","#3D3D3D","#797979"];
const DEFAULT_SINGLE_COLOR = defaultColors[1] || "#3D3D3D";

const uiOrder2col = ["1","2","3","4","5","6","7","8","9","0"];
const uiOrder1col = ["1","2","3","4","5","6","7","8","9","0"];
let uiOrder = uiOrder2col.slice();
const uiLabels = {"1":"1","2":"2","3":"3","4":"4","5":"5","6":"6","7":"7","8":"8","9":"9","0":"0"};
let colorMap = {};

const canvas = document.getElementById('preview');
const ctx = canvas.getContext('2d');
const previewImage = document.getElementById('previewImage');

const circlePositions = [
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 1 + 56, y:CENTER_VERTICAL_GAP + 0 * CIRCLE_GAP, label:"1"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 2 + 56, y:CENTER_VERTICAL_GAP + 0 * CIRCLE_GAP, label:"2"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 3 + 56, y:CENTER_VERTICAL_GAP + 0 * CIRCLE_GAP, label:"3"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 4 + 56, y:CENTER_VERTICAL_GAP + 0 * CIRCLE_GAP, label:"4"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 5 + 56, y:CENTER_VERTICAL_GAP + 0 * CIRCLE_GAP, label:"5"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 1 + 56, y:CENTER_VERTICAL_GAP + 1 * CIRCLE_GAP, label:"6"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 2 + 56, y:CENTER_VERTICAL_GAP + 1 * CIRCLE_GAP, label:"7"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 3 + 56, y:CENTER_VERTICAL_GAP + 1 * CIRCLE_GAP, label:"8"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 4 + 56, y:CENTER_VERTICAL_GAP + 1 * CIRCLE_GAP, label:"9"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 5 + 56, y:CENTER_VERTICAL_GAP + 1 * CIRCLE_GAP, label:"0"},
];

function luminance(hex){
  const h=hex.replace('#','');
  const r=parseInt(h.substring(0,2),16)/255;
  const g=parseInt(h.substring(2,4),16)/255;
  const b=parseInt(h.substring(4,6),16)/255;
  const srgb=[r,g,b].map(c=>c<=0.03928?c/12.92:Math.pow((c+0.055)/1.055,2.4));
  return 0.2126*srgb[0]+0.7152*srgb[1]+0.0722*srgb[2];
}

// 色味を保ったまま明度を下げる
function darkenColor(hex, amount = 30) {
  const h = hex.replace('#','');
  let r = parseInt(h.substring(0,2),16);
  let g = parseInt(h.substring(2,4),16);
  let b = parseInt(h.substring(4,6),16);

  r /= 255; g /= 255; b /= 255;
  const max = Math.max(r,g,b), min = Math.min(r,g,b);
  let hsl_h, hsl_s, hsl_l = (max+min)/2;

  if(max===min){
    hsl_h = hsl_s = 0;
  } else {
    const d = max-min;
    hsl_s = hsl_l > 0.5 ? d/(2-max-min) : d/(max+min);
    switch(max){
      case r: hsl_h = (g-b)/d + (g<b?6:0); break;
      case g: hsl_h = (b-r)/d + 2; break;
      case b: hsl_h = (r-g)/d + 4; break;
    }
    hsl_h /= 6;
  }

  hsl_l = Math.max(0, hsl_l - amount/100);

  function hue2rgb(p,q,t){
    if(t<0) t+=1;
    if(t>1) t-=1;
    if(t<1/6) return p+(q-p)*6*t;
    if(t<1/2) return q;
    if(t<2/3) return p+(q-p)*(2/3-t)*6;
    return p;
  }

  let r2,g2,b2;
  if(hsl_s===0){
    r2=g2=b2=hsl_l;
  } else {
    const q = hsl_l < 0.5 ? hsl_l*(1+hsl_s) : hsl_l+hsl_s-hsl_l*hsl_s;
    const p = 2*hsl_l-q;
    r2 = hue2rgb(p,q,hsl_h+1/3);
    g2 = hue2rgb(p,q,hsl_h);
    b2 = hue2rgb(p,q,hsl_h-1/3);
  }

  return `#${Math.round(r2*255).toString(16).padStart(2,'0')}`
       + `${Math.round(g2*255).toString(16).padStart(2,'0')}`
       + `${Math.round(b2*255).toString(16).padStart(2,'0')}`;
}

function loadFromURL(){
  const p=new URLSearchParams(location.search);
  uiOrder.forEach(k=>{
    const v = p.get(k) || DEFAULT_SINGLE_COLOR;
    colorMap[k] = [v];
  });
}

function saveToURL(){
  const p=new URLSearchParams();
  uiOrder.forEach(k=>{ p.set(k, colorMap[k][0]); });
  history.replaceState(null,'','?'+p.toString());
  if(navigator.clipboard) navigator.clipboard.writeText(location.href).catch(()=>{});
}

function makeControls(){
  const grid=document.getElementById('controlsGrid');
  grid.innerHTML='';
  uiOrder.forEach(k=>{
    const card=document.createElement('div'); card.className='kana-card';
    const row=document.createElement('div'); row.className='kana-row';
    const lab=document.createElement('label'); lab.textContent=uiLabels[k];
    row.appendChild(lab);
    if(!colorMap[k]) colorMap[k] = [      DEFAULT_SINGLE_COLOR];
    const inp=document.createElement('input');
    inp.type='color'; 
    inp.className='color-input';
    inp.value=colorMap[k][0];
    inp.addEventListener('input', e=>{
      colorMap[k][0] = e.target.value;
      saveToURL();
      render();
    });
    row.appendChild(inp);
    card.appendChild(row);
    grid.appendChild(card);
  });
}

function drawCircleWithText(x,y,text,col){
  ctx.save();
  ctx.beginPath();
  ctx.arc(x,y,CIRCLE_RADIUS,0,Math.PI*2);
  ctx.fillStyle=col;
  ctx.fill();
  ctx.lineWidth=CIRCLE_STROKE_WIDTH;
  ctx.strokeStyle=darkenColor(col,30);  // 縁取りは少し濃い色
  ctx.stroke();
  ctx.closePath();

  ctx.font=`${CIRCLE_RADIUS*FONT_SIZE_RATIO}px "Noto Sans JP",sans-serif`;
  ctx.textAlign='center';
  ctx.textBaseline='middle';
  const lum=luminance(col);
  ctx.fillStyle= lum>BRIGHTNESS_THRESHOLD ? '#000':'#fff';
  ctx.lineWidth=TEXT_STROKE_WIDTH;
  ctx.strokeStyle= lum>BRIGHTNESS_THRESHOLD ? '#fff':'#000';
  ctx.strokeText(text,x,y);
  ctx.fillText(text,x,y);
  ctx.restore();
}

function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.fillStyle="#fff";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.restore();
  ctx.save();
  ctx.translate(200,0);
  circlePositions.forEach(p=>{
    drawCircleWithText(p.x,p.y,p.label,colorMap[p.label][0]);
  });
  ctx.restore();
  previewImage.src=canvas.toDataURL('image/png');
}

// URL読み込みと初期描画
loadFromURL();
makeControls();
render();

// 保存ボタン
document.getElementById('saveBtn').addEventListener('click',()=>{
  saveToURL();
  document.getElementById('saveModal').style.display='block';
});

// モーダル閉じる
document.getElementById('saveClose').addEventListener('click',()=>{
  document.getElementById('saveModal').style.display='none';
});

// 初期化ボタン
document.getElementById('resetBtn').addEventListener('click',()=>{
  uiOrder.forEach(k=>{colorMap[k]=[DEFAULT_SINGLE_COLOR];});
  saveToURL();
  makeControls();
  render();
});

// シェアボタン
document.getElementById('shareBtn').addEventListener('click',()=>{
  const url=location.href;
  const text="私の数字の色感覚はこんな感じ！";
  const shareUrl=`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
  window.open(shareUrl,'_blank');
});
</script>
</body>
</html>
