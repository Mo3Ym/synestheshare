<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SynestheShare ã€Œæ•°å­—ã£ã¦ã©ã‚“ãªè‰²ï¼Ÿã€</title>
<link rel="icon" href="./assets/icons/favicon.ico">
<!-- Google Fonts çµŒç”±ã§ Noto Sans JP ã‚’èª­ã¿è¾¼ã¿ -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@600;800&display=swap" rel="stylesheet">
<!-- Google Fonts Outfit ã‚’èª­ã¿è¾¼ã¿ -->
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">
<!-- Google Fonts Outfit ExtraLight 200ã‚’èª­ã¿è¾¼ã¿ -->
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="assets/css/main_sub.css" />
<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>

<style>
@font-face {
  font-family: 'font';
  src: url('font/03ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ãƒˆUI.otf') format('opentype');
}
@font-face {
  font-family: 'ar-gothic';
  src: url('AR-ADGothicJP-Medium.otf') format('opentype');
}

:root{--bg:#FFFFFF;--ui:#111}

html, body {
  height:100%;
  margin:0;
  padding:0;
  font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Helvetica,Arial,sans-serif;
  background:var(--bg);
  color:var(--ui);
}

/* ãƒ­ã‚´å¸¯ */
.logo {
  background-color: #f0f0f0;
  width: 100%;
  padding: 20px 0;
  display: flex;
  justify-content: center;
  align-items: center;
}
.logo a {
  display: inline-block;
  margin: 0;
  padding: 0;
}
.logo img {
  display: block;
  margin: 0 auto;
  max-width: 70%;  /* åŸºæœ¬: å¹…70%ä»¥å†… */
  height: auto;
}

/* ãƒ‡ãƒã‚¤ã‚¹ã”ã¨ã®ãƒ­ã‚´ã‚µã‚¤ã‚º */
@media (min-width:1024px) {  /* PC */
  .logo img { max-width: 25%; }
}
@media (min-width:600px) and (max-width:1023px) {  /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ */
  .logo img { max-width: 50%; }
}
@media (max-width:599px) {  /* ã‚¹ãƒãƒ› */
  .logo img { max-width: 70%; }
}

/* ä»¥ä¸‹ã¯å…ƒã®CSSï¼ˆå¿…è¦éƒ¨åˆ†ã®ã¿æŠœç²‹ï¼‰ */
.wrap{
  max-width:800px;
  margin:0 auto;
  padding:14px;
  display:flex;
  flex-direction:column;
  align-items:center;
}
h1{font-size:18px;margin:0 0 8px;font-weight:800;text-align:center}

/* controls ã‚°ãƒªãƒƒãƒ‰ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ï¼šç”»é¢å¹…ã«å¿œã˜ã¦1ã€œ5åˆ—ã€æœ€å¤§5åˆ—ï¼‰  
   å„ã‚»ãƒ«ï¼ˆæ ï¼‰ã¯ã‚°ãƒªãƒƒãƒ‰ã®å¹…ã«åˆã‚ã›ã¦æ¨ªã„ã£ã±ã„ã«åºƒãŒã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚  
   ã‚°ãƒªãƒƒãƒ‰ã® gap ã¯æ åŒå£«ã®ã€Œé©åº¦ãªé–“éš”ã€ã‚’æ‹…ä¿ã—ã¾ã™ã€‚ */
.controls-grid{
  display:grid;
  gap:12px; /* æ åŒå£«ã®é©åº¦ãªé–“éš”ï¼ˆèª¿æ•´å¯ï¼‰ */
  margin-bottom:10px;
  width:100%;
  grid-template-columns: repeat(1, 1fr); /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 1åˆ—ï¼ˆå°ã•ã„ã‚¹ãƒãƒ›ï¼‰ */
  align-items: start;
}

/* ã‚«ãƒ¼ãƒ‰ï¼ˆæ ï¼‰--- æ ç·šã¯æ®‹ã—ã¤ã¤ä¸­å¤®æƒãˆã€å†…å´ã¯ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */  
/* é‡è¦: width:100% ã«ã—ã¦ã‚°ãƒªãƒƒãƒ‰ã‚»ãƒ«ã®å¹…ã‚’åŸ‹ã‚ã‚‹ã‚ˆã†ã«ã™ã‚‹ */
.kana-card{
  border:1px solid #eee;
  padding:6px 8px;           /* å°ã•ã‚ã«ã—ã¦ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
  border-radius:6px;
  background:#fff;

  display:flex;              /* ä¸­èº«ã‚’ä¸­å¤®æƒãˆã™ã‚‹ãŸã‚ã® flex */
  justify-content:center;
  align-items:center;

  box-sizing:border-box;
  width:100%;                /* ã‚°ãƒªãƒƒãƒ‰ã‚»ãƒ«ã®æ¨ªå¹…ã‚’åŸ‹ã‚ã‚‹ */
  min-height:44px;
  /* max-width ã‚’è¨­å®šã—ãªã„ã“ã¨ã§ã€å„ã‚»ãƒ«ã§ä½™ç™½ãŒæ®‹ã‚‰ãªã„ã‚ˆã†ã«ã—ã¾ã™ */
}
.kana-row{display:flex;align-items:center;gap:8px;flex-wrap:nowrap}
.kana-row label{
  width:auto;                /* å›ºå®šå¹…ã‚’è§£é™¤ã—ã¦ä¸­å¤®æƒãˆã—ã‚„ã™ã */
  font-weight:700;
  text-align:center;
  display:inline-block;
  line-height:1;
}
.color-input{
  width:40px;
  height:40px;
  border:0;
  padding:0;
  background:none;
  -webkit-appearance:none;
  appearance:none;
  border-radius:50%;
  aspect-ratio:1/1;
}
.color-input::-webkit-color-swatch{
  border:none;
  border-radius:50%;
  padding:0;
}
.color-input::-webkit-color-swatch-wrapper{
  border-radius:50%;
  padding:0;
}
.color-input::-moz-color-swatch{
  border:none;
  border-radius:50%;
}
.small-btn{padding:6px 8px;border-radius:6px;border:1px solid #ddd;background:#fafafa;font-size:13px;cursor:pointer}
.preview{display:flex;justify-content:center;margin:12px 0;width:100%}
canvas{display:none;}
#previewImage{
  max-width:100%;
  height:auto;
  border-radius:8px;
  box-shadow:0 8px 20px rgba(0,0,0,0.06);
  background:#fff;
  display:block;
  border:1px solid #ccc;
}
.actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-bottom:12px;width:100%}
button.main{padding:10px 12px;border-radius:8px;border:0;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:6px;background-color:#ffffff;}
button.black{padding:10px 12px;border-radius:8px;border:0;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:6px;background-color:#000000;color:#ffffff;}
.download{background:#1da1f2;color:#fff}
.share{background:#111;color:#fff}
.hint{font-size:14px;color:#666;margin-top:6px;text-align:center}
footer{display:flex;justify-content:center;padding-top:10px;font-size:14px;color:#111;width:100%}
.ex{font-size:12px;color:#666;margin-top:6px;text-align:center}
.footer-separator{
  width:100%;
  border-top:1px solid #ddd;
  margin:20px 0 10px 0;
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ï¼šå¹…ã«å¿œã˜ã¦åˆ—æ•°ã‚’å¢—ã‚„ã™ï¼ˆæœ€å¤§5åˆ—ï¼‰ */
@media (min-width:360px){
  .controls-grid{ grid-template-columns: repeat(2, 1fr); }
}
@media (min-width:720px){
  .controls-grid{ grid-template-columns: repeat(3, 1fr); }
}
@media (min-width:980px){
  .controls-grid{ grid-template-columns: repeat(4, 1fr); }
}
@media (min-width:1200px){
  .controls-grid{ grid-template-columns: repeat(5, 1fr); } /* PCç­‰ã®æœ€å¤§æ™‚ã‚‚1è¡Œ5å€‹ã¾ã§ */
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ« */
.modal {
  display:none; 
  position:fixed;
  z-index:1000;
  left:0;top:0;
  width:100%;height:100%;
  overflow:auto;
  background:rgba(0,0,0,0.6);
}
.modal-content {
  background:#fff;
  margin:10% auto;
  padding:20px;
  border-radius:10px;
  max-width:400px;
  text-align:center;
}
.modal-content p {
  text-align: left; /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å†…ã®æ–‡ç« ã ã‘å·¦è©°ã‚ã«å¤‰æ›´ */
}
.modal-content img{
  max-width:100%;
  height:auto;
  margin-top:10px;
}
.close {
  color:#aaa;
  float:right;
  font-size:24px;
  font-weight:bold;
  cursor:pointer;
}

/* --- ã“ã“ã‹ã‚‰è¿½åŠ ï¼ˆå®Œæˆãƒ¢ãƒ¼ãƒ€ãƒ«ã®è¦‹ãŸç›®èª¿æ•´ï¼‰ --- */
/* modal å†…ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒã« previewImage ã¨åŒæ§˜ã®ç¸å–ã‚Šã‚’ä»˜ã‘ã‚‹ */
#modalPreview{
  max-width:100%;
  height:auto;
  border-radius:8px;
  box-shadow:0 8px 20px rgba(0,0,0,0.06);
  background:#fff;
  display:block;
  border:1px solid #ccc;
  margin:10px auto;
  /* ã‚ˆã‚Šç›®ç«‹ãŸã›ãŸã„å ´åˆã¯ä»¥ä¸‹ã‚’èª¿æ•´ */
}

/* å®Œæˆãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®ä¿å­˜æ¡ˆå†…ã‚’ä¸­å¤®æƒãˆï¼ˆ.modal-content p {text-align:left} ã®ä¸Šæ›¸ãï¼‰ */
#completeModal .hint{
  text-align:center;
  margin-top:10px;
}

#completeModal .actions button img{
  display:inline-block;
  vertical-align:middle;
  /* é«˜ã•ã¯å…ƒã®16pxã«åˆã‚ã›ã‚‹ï¼ˆå¿…è¦ãªã‚‰èª¿æ•´ï¼‰ */
  width:16px;
  height:16px;
}
/* --- ã“ã“ã¾ã§è¿½åŠ  --- */

  /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
  .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:1000; }
  .modal-content { position:relative; background:white; padding:20px; border-radius:10px; text-align:center; max-width:90%; max-height:90%; }
  .modal-content img { max-width:100%; max-height:60vh; border-radius:5px; }
  .close { position:absolute; top:10px; right:15px; font-size:24px; cursor:pointer; }
  .hint { font-size:14px; margin-top:10px; color:#555; }

  /* ãƒ¢ãƒ¼ãƒ€ãƒ«å°‚ç”¨ã‚­ãƒ£ãƒ³ãƒã‚¹ */
  #modalConfetti { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:999; }

</style>
</head>

<body>
<!-- ãƒ­ã‚´ï¼ˆwrapã®å¤–ã«ç§»å‹•æ¸ˆã¿ï¼‰ -->
<div class="logo">
  <a href="index.html" target="_blank">
    <img src="images_sub/logo.png" alt="SynestheShare ãƒ­ã‚´">
  </a>
</div>

<div class="wrap">
    <!-- Step1ç”»åƒ -->
    <div class="step1"><h1_1><img src="images_sub/step1_icon.png" style="height:35px;"><font size=4><b>è‰²ã‚’é¸æŠ</b></font></h1_1></div>
    <br>

    <!-- ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ -->
    <div class="controls-grid" id="controlsGrid"></div>

    <!-- ä¸€æ™‚ä¿å­˜ / åˆæœŸåŒ–ãƒœã‚¿ãƒ³ -->
    <div class="actions">
      <button id="saveBtn" class="button big wide smooth-scroll-middle"><img src="images_sub/save.png" alt="" style="width:18px;height:18px;"><span>å…¥åŠ›å†…å®¹ã‚’ä¿å­˜</span></button>
      <button id="resetBtn" class="button big wide smooth-scroll-middle"><img src="images_sub/reset.png" alt="" style="width:18px;height:18px;">è‰²ã‚’åˆæœŸåŒ–</button>
    </div>

    <br><br><br><br><br>

    <!-- Step2ç”»åƒ -->
    <div class="step2"><h1_2><img src="images_sub/step2_icon.png" style="height:30px;"><font size=4><b>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</b></font></h1_2></div>

    <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒ -->
    <div class="preview">
      <canvas id="preview" width="1300" height="1300"></canvas>
      <img id="previewImage" alt="ç”Ÿæˆç”»åƒ" />
    </div>

    <!-- å®Œæˆãƒœã‚¿ãƒ³ -->
    <div class="actions">
      <button class="button big wide smooth-scroll-middle" id="completeBtn"><img src="images_sub/check.png" style="width:16px;height:16px;">ã“ã®è‰²ã§OKï¼</button>
    </div>
    <br><br><br>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <div class="footer-separator"></div>
    <p class="ex">&copy; Untitled. Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
    <p class="ex">ãƒ•ã‚©ãƒ³ãƒˆï¼šã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ãƒˆUI<br>ãƒ•ãƒªãƒ¼ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼šhttps://flopdesign.booth.pm/items/2296502</p>
</div>

<!-- å…¥åŠ›å†…å®¹ã®ä¿å­˜ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="saveModal" class="modal">
  <div class="modal-content">
    <span class="close" id="saveClose">&times;</span>
    <p>ã‚µã‚¤ãƒˆURLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãƒ¡ãƒ¢ã‚¢ãƒ—ãƒªç­‰ã«ä¿å­˜ã—ã¦ãã ã•ã„ã€‚<br>â€»é¸æŠã—ãŸè‰²æƒ…å ±ã¯URLã®<font color="#FF6969">æœ«å°¾</font>ã«å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚</p>
    <img src="images_sub/howtosave.png" alt="ä¿å­˜æ–¹æ³•">
  </div>
</div>

<!-- å®Œæˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="completeModal" class="modal">
  <div class="modal-content">
    <span class="close" id="completeClose">&times;</span>
ã€€ã€€<br><br><h1>ğŸ‰å®Œæˆï¼ğŸ‰</h1>
    <img id="modalPreview" alt="ç”Ÿæˆç”»åƒ">
    <p class="hint">ç”»åƒã‚’ <b>é•·æŠ¼ã—</b> ã¾ãŸã¯ <b>å³ã‚¯ãƒªãƒƒã‚¯</b> ã§ä¿å­˜</p>
    <!-- Xã§ãƒã‚¹ãƒˆãƒœã‚¿ãƒ³ -->
    <div class="actions">
      <button  class="button big wide smooth-scroll-middle" id="shareBtn"><img src="images_sub/post.png" alt="x" style="width:18px;height:18px;">ã§ãƒã‚¹ãƒˆ</button>
    </div>
  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«å°‚ç”¨ã‚­ãƒ£ãƒ³ãƒã‚¹ -->
  <canvas id="modalConfetti"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
// è¨­å®š
// æ–‡å­—ã®å¤§ãã•ï¼ˆä¸¸ã¨ã®æ¯”è¼ƒå€¤ï¼‰
const FONT_SIZE_RATIO = 0.8;
// æ–‡å­—ã¨ä¸¸ã«ç¸å–ã‚ŠãŒã•ã‚Œã‚‹ã—ãã„å€¤
const BRIGHTNESS_THRESHOLD = 0.8;
// æ–‡å­—ã®ç¸å–ã‚Šã®è‰²
const TEXT_STROKE_COLOR = '#B0B0B0';
// æ–‡å­—ã®ç¸å–ã‚Šã®å¤ªã•
const TEXT_STROKE_WIDTH = 1;
// ä¸¸ã®ç¸å–ã‚Šã®è‰²
const CIRCLE_STROKE_COLOR = '#B0B0B0';
// ä¸¸ã®ç¸å–ã‚Šã®å¤ªã•
const CIRCLE_STROKE_WIDTH = 0.5;

// ãŠé¡Œã®æ ç·šã®å¤ªã•
const BORDER_LINE_WIDTH = 4;

// ä¸¸ã®ã‚µã‚¤ã‚º
const CIRCLE_RADIUS = 100;
// ä¸¸ã®ç¸¦é–“éš”
const CIRCLE_GAP = 232;
// ä¸¸ã®æ¨ªé–“éš”
const CIRCLE_HORIZONTAL_GAP = 232;
// ä¸¸ã®ç¸¦ã®é–‹å§‹ä½ç½®
const CENTER_VERTICAL_GAP = 602;

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé…è‰²
// æŒ‡å®šã®ãƒãƒƒãƒ”ãƒ³ã‚°ã«å¾“ã„ã¾ã™ï¼ˆ1ã¨6ï¼š#000000ã€2ã¨7ï¼š#404040ã€3ã¨8ï¼š#7F7F7Fã€4ã¨9ï¼š#BFBFBFã€5ã¨0ï¼š#E0E0E0ï¼‰
const defaultSingleColors = {
  "1": "#000000",
  "6": "#000000",
  "2": "#404040",
  "7": "#404040",
  "3": "#7F7F7F",
  "8": "#7F7F7F",
  "4": "#BFBFBF",
  "9": "#BFBFBF",
  "5": "#E0E0E0",
  "0": "#E0E0E0"
};

// UIé †åº
const uiOrder2col = ["1","2","3","4","5","6","7","8","9","0"];
const uiOrder1col = ["1","2","3","4","5","6","7","8","9","0"];
let uiOrder = uiOrder2col.slice();
const uiLabels = {"1":"1","2":"2","3":"3","4":"4","5":"5","6":"6","7":"7","8":"8","9":"9","0":"0"};
let colorMap = {};

const canvas = document.getElementById('preview');
const ctx = canvas.getContext('2d');
const previewImage = document.getElementById('previewImage');

const circlePositions = [
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 1 + 56, y:CENTER_VERTICAL_GAP + 0 * CIRCLE_GAP, label:"1"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 2 + 56, y:CENTER_VERTICAL_GAP + 0 * CIRCLE_GAP, label:"2"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 3 + 56, y:CENTER_VERTICAL_GAP + 0 * CIRCLE_GAP, label:"3"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 4 + 56, y:CENTER_VERTICAL_GAP + 0 * CIRCLE_GAP, label:"4"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 5 + 56, y:CENTER_VERTICAL_GAP + 0 * CIRCLE_GAP, label:"5"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 1 + 56, y:CENTER_VERTICAL_GAP + 1 * CIRCLE_GAP, label:"6"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 2 + 56, y:CENTER_VERTICAL_GAP + 1 * CIRCLE_GAP, label:"7"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 3 + 56, y:CENTER_VERTICAL_GAP + 1 * CIRCLE_GAP, label:"8"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 4 + 56, y:CENTER_VERTICAL_GAP + 1 * CIRCLE_GAP, label:"9"},
  {x:-102 + CIRCLE_HORIZONTAL_GAP * 5 + 56, y:CENTER_VERTICAL_GAP + 1 * CIRCLE_GAP, label:"0"},
];

function luminance(hex){
  const h=hex.replace('#','');
  const r=parseInt(h.substring(0,2),16)/255;
  const g=parseInt(h.substring(2,4),16)/255;
  const b=parseInt(h.substring(4,6),16)/255;
  const srgb=[r,g,b].map(c=>c<=0.03928?c/12.92:Math.pow((c+0.055)/1.055,2.4));
  return 0.2126*srgb[0]+0.7152*srgb[1]+0.0722*srgb[2];
}

function loadFromURL(){
  const p=new URLSearchParams(location.search);
  uiOrder.forEach(k=>{
    const v = p.get(k);
    // URLã«å€¤ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ã„ã€ç„¡ã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒƒãƒ—ã‚’ä½¿ã†
    colorMap[k] = [ v ? v : (defaultSingleColors[k] || "#3D3D3D") ];
  });
}

function saveToURL(){
  const p=new URLSearchParams();
  uiOrder.forEach(k=>{ p.set(k, colorMap[k][0]); });
  history.replaceState(null,'','?'+p.toString());
  if(navigator.clipboard) navigator.clipboard.writeText(location.href).catch(()=>{});
}

function makeControls(){
  const grid=document.getElementById('controlsGrid');
  grid.innerHTML='';
  uiOrder.forEach(k=>{
    const card=document.createElement('div'); card.className='kana-card';
    const row=document.createElement('div'); row.className='kana-row';
    const lab=document.createElement('label'); lab.textContent=uiLabels[k];
    row.appendChild(lab);
    if(!colorMap[k]) colorMap[k] = [ defaultSingleColors[k] || "#3D3D3D" ];
    const inp=document.createElement('input');
    inp.type='color'; inp.value=colorMap[k][0]; inp.className='color-input';
    inp.addEventListener('input',()=>{ colorMap[k][0]=inp.value; drawPreview(); saveToURL(); });
    row.appendChild(inp);
    card.appendChild(row);
    grid.appendChild(card);
  });
}

function drawCircleWithText(cx, cy, r, col, kana){
  ctx.beginPath();
  ctx.arc(cx, cy, r, 0, Math.PI*2);
  ctx.fillStyle = col; ctx.fill();
  if(luminance(col) > BRIGHTNESS_THRESHOLD){
    ctx.lineWidth = CIRCLE_STROKE_WIDTH;
    ctx.strokeStyle = CIRCLE_STROKE_COLOR;
    ctx.stroke();
  }
  ctx.closePath();
  // ç”Ÿæˆç”»åƒå†…ã®æ•°å­—ã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚©ãƒ³ãƒˆ "font" ã‚’ä½¿ç”¨ã™ã‚‹
  ctx.font = `bold ${Math.round(r*FONT_SIZE_RATIO)}px "font"`;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  if(luminance(col) > BRIGHTNESS_THRESHOLD){
    ctx.lineWidth = TEXT_STROKE_WIDTH;
    ctx.strokeStyle = TEXT_STROKE_COLOR;
    ctx.strokeText(kana, cx, cy+r*0.05);
  }
  ctx.fillStyle = '#fff';
  ctx.fillText(kana, cx, cy+r*0.05);
}

function drawFooterHash() {
  const text = "#SynestheShare";
  ctx.font = '600 35px "Outfit", sans-serif';
  ctx.textAlign = 'right';
  ctx.textBaseline = 'alphabetic';
  ctx.fillStyle = '#000000';
  ctx.fillText(text, canvas.width - 24, canvas.height - 24);
}

function drawPreview(){
  try{
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='#fff'; ctx.fillRect(0,0,canvas.width,canvas.height);
    const rectX = 60, rectY = 75, rectW = 1180, rectH = 150, radius = 36;
    ctx.beginPath();
    ctx.moveTo(rectX+radius, rectY);
    ctx.lineTo(rectX+rectW-radius, rectY);
    ctx.quadraticCurveTo(rectX+rectW, rectY, rectX+rectW, rectY+radius);
    ctx.lineTo(rectX+rectW, rectY+rectH-radius);
    ctx.quadraticCurveTo(rectX+rectW, rectY+rectH, rectX+rectW-radius, rectY+rectH);
    ctx.lineTo(rectX+radius, rectY+rectH);
    ctx.quadraticCurveTo(rectX, rectY+rectH, rectX, rectY+rectH-radius);
    ctx.lineTo(rectX, rectY+radius);
    ctx.quadraticCurveTo(rectX, rectY, rectX+radius, rectY);
    ctx.closePath();
    ctx.strokeStyle='#000';
    ctx.lineWidth=BORDER_LINE_WIDTH;
    ctx.stroke();
    ctx.font='700 42px "Noto Sans JP"';
    ctx.fillStyle='#000'; ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText("æ•°å­—ã£ã¦ã©ã‚“ãªè‰²ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼Ÿ", rectX+rectW/2, rectY+rectH/2+2);
    circlePositions.forEach(pos=>{
      const col = (colorMap[pos.label] && colorMap[pos.label][0]) || defaultSingleColors[pos.label] || "#3D3D3D";
      drawCircleWithText(pos.x, pos.y, CIRCLE_RADIUS, col, pos.label);
    });
    drawFooterHash();
    previewImage.src = canvas.toDataURL('image/png');
  }catch(e){console.error(e);}
}

document.getElementById('saveBtn').addEventListener('click',()=>{saveToURL(); document.getElementById('saveModal').style.display='block';});
document.getElementById('resetBtn').addEventListener('click',()=>{
  try {
    const confirmed = confirm("å…¨ã¦ã®è‰²ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¦è‰¯ã„ã§ã™ã‹ï¼Ÿ");
    if (confirmed === false) return;
  } catch(e) {
    // confirm ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒåˆ©ç”¨ã§ããªã„ç’°å¢ƒï¼ˆä¾‹: iPhone ã®ã€Œãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã—ãªã„ã€è¨­å®šãªã©ï¼‰ã®å ´åˆã¯
    // ç¢ºèªãªã—ã§å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ï¼ˆä»•æ§˜ã«åŸºã¥ãï¼‰
  }
  uiOrder.forEach(k=>colorMap[k]=[ defaultSingleColors[k] || "#3D3D3D" ]);
  makeControls(); drawPreview(); saveToURL();
});
document.getElementById('shareBtn').addEventListener('click',()=>{
  const text = "#SynestheShare https://mo3ym.github.io/synestheshare/";
  const share = `https://x.com/intent/tweet?text=${encodeURIComponent(text)}`;
  window.open(share,'_blank');
});
document.getElementById('saveClose').addEventListener('click',()=>{document.getElementById('saveModal').style.display='none';});
window.addEventListener('click',e=>{if(e.target===document.getElementById('saveModal')){document.getElementById('saveModal').style.display='none';}});

// ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆåˆ—æ•°ï¼‰èª¿æ•´ï¼šè¡¨ç¤ºå¹…ã«åˆã‚ã›ã¦ uiOrder ã‚’æ±ºã‚ã‚‹ï¼ˆå¿…è¦ãªã‚‰ï¼‰
function updateUIOrder(){
  // ã“ã“ã§ã¯UIå†…ã®ä¸¦ã³è‡ªä½“ã¯å¤‰ãˆãšã€controls-grid ã®åˆ—æ•°ã¯CSSãƒ¡ãƒ‡ã‚£ã‚¢ã‚¯ã‚¨ãƒªã§åˆ¶å¾¡ã—ã¾ã™ã€‚
  // ã—ã‹ã—å°†æ¥çš„ã« JS å´ã§ä¸¦ã³æ›¿ãˆãŒå¿…è¦ãªã‚‰ã“ã“ã§å¯¾å¿œå¯èƒ½ã§ã™ã€‚
  if(window.innerWidth < 600) uiOrder = uiOrder1col.slice();
  else uiOrder = uiOrder2col.slice();
}
window.addEventListener('resize',()=>{ updateUIOrder(); makeControls(); drawPreview(); });

loadFromURL();
makeControls();

// ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚©ãƒ³ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã‹ã‚‰ã‚­ãƒ£ãƒ³ãƒã‚¹ã«æç”»ã™ã‚‹ã“ã¨ã§ã€ç”Ÿæˆç”»åƒå†…ã®æ•°å­—ãŒç¢ºå®Ÿã« "font/03ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ãƒˆUI.otf" ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹
if (document.fonts && document.fonts.load) {
  // ãƒ•ã‚©ãƒ³ãƒˆã‚’ç¢ºå®Ÿã«ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‹ã‚‰æç”»ï¼ˆè¤‡æ•°æŒ‡å®šã§å®‰å…¨ã‚’è¦‹ã¾ã™ï¼‰
  Promise.all([
    document.fonts.load('12px "font"'),
    document.fonts.load('bold 12px "font"'),
    document.fonts.load('600 35px "Outfit"')
  ]).then(()=>{ drawPreview(); }).catch(()=>{ drawPreview(); });
} else {
  drawPreview();
}
const completeBtn = document.getElementById('completeBtn');
const completeModal = document.getElementById('completeModal');
const completeClose = document.getElementById('completeClose');
const modalPreview = document.getElementById('modalPreview');
const modalCanvas = document.getElementById('modalConfetti');

// modalCanvas ã‚’å–å¾—ã—ã¦ã‹ã‚‰ confetti.create ã‚’å‘¼ã¶
const myConfetti = confetti.create(modalCanvas, { resize: true });

completeBtn.addEventListener('click', () => {
  // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒã‚’ãƒ¢ãƒ¼ãƒ€ãƒ«ã«ã‚³ãƒ”ãƒ¼
  modalPreview.src = canvas.toDataURL('image/png');

  // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
  completeModal.style.display = 'flex';

  // ç´™å¹é›ªç™ºå‹•
  myConfetti({
    particleCount: 150,
    spread: 100,
    origin: { y: 0.5 }
  });
});

completeClose.addEventListener('click', () => {
  completeModal.style.display = 'none';
});

window.addEventListener('click', e => {
  if (e.target === completeModal) {
    completeModal.style.display = 'none';
  }
});
</script>
</body>
</html>
